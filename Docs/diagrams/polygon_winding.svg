<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600">
  <!-- Background -->
  <rect width="900" height="600" fill="#f8fafc"/>

  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="20" font-weight="bold" fill="#1e293b">Polygon Winding Order &amp; Line Ownership</text>

  <!-- Left diagram: Clockwise winding -->
  <g transform="translate(50, 60)">
    <text x="150" y="0" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#475569">Clockwise Winding (Required)</text>

    <!-- Polygon -->
    <polygon points="50,50 250,50 250,200 50,200" fill="#dbeafe" stroke="#2563eb" stroke-width="2"/>

    <!-- Vertices with labels -->
    <circle cx="50" cy="50" r="8" fill="#2563eb"/>
    <text x="35" y="45" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#1e40af">e0</text>

    <circle cx="250" cy="50" r="8" fill="#2563eb"/>
    <text x="260" y="45" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#1e40af">e1</text>

    <circle cx="250" cy="200" r="8" fill="#2563eb"/>
    <text x="260" y="210" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#1e40af">e2</text>

    <circle cx="50" cy="200" r="8" fill="#2563eb"/>
    <text x="35" y="210" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#1e40af">e3</text>

    <!-- Direction arrows (clockwise) - using simple triangles -->
    <line x1="70" y1="50" x2="210" y2="50" stroke="#16a34a" stroke-width="3"/>
    <polygon points="220,50 205,44 205,56" fill="#16a34a"/>

    <line x1="250" y1="70" x2="250" y2="165" stroke="#16a34a" stroke-width="3"/>
    <polygon points="250,175 244,160 256,160" fill="#16a34a"/>

    <line x1="230" y1="200" x2="90" y2="200" stroke="#16a34a" stroke-width="3"/>
    <polygon points="80,200 95,194 95,206" fill="#16a34a"/>

    <line x1="50" y1="180" x2="50" y2="85" stroke="#16a34a" stroke-width="3"/>
    <polygon points="50,75 44,90 56,90" fill="#16a34a"/>

    <!-- Center label -->
    <text x="150" y="130" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#1e40af">Polygon A</text>

    <!-- Clockwise indicator in center -->
    <circle cx="150" cy="125" r="25" fill="none" stroke="#16a34a" stroke-width="2" stroke-dasharray="4,2"/>
    <text x="150" y="170" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#16a34a">clockwise</text>

    <!-- Note -->
    <text x="150" y="240" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#475569">endpoint_indexes[] = {e0, e1, e2, e3}</text>
    <text x="150" y="255" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#64748b">from map.h:578</text>
  </g>

  <!-- Right diagram: Line ownership -->
  <g transform="translate(470, 60)">
    <text x="170" y="0" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#475569">Line Ownership (Two Polygons)</text>

    <!-- Polygon A (left) -->
    <polygon points="20,50 170,50 170,200 20,200" fill="#dbeafe" stroke="#2563eb" stroke-width="2"/>
    <text x="95" y="130" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#1e40af">Polygon A</text>

    <!-- Polygon B (right) -->
    <polygon points="170,50 320,50 320,200 170,200" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
    <text x="245" y="130" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#166534">Polygon B</text>

    <!-- Shared line (emphasized) -->
    <line x1="170" y1="50" x2="170" y2="200" stroke="#7c3aed" stroke-width="5"/>

    <!-- Line endpoints -->
    <circle cx="170" cy="50" r="6" fill="#7c3aed"/>
    <text x="180" y="45" font-family="system-ui, sans-serif" font-size="10" font-weight="bold" fill="#7c3aed">e0</text>

    <circle cx="170" cy="200" r="6" fill="#7c3aed"/>
    <text x="180" y="210" font-family="system-ui, sans-serif" font-size="10" font-weight="bold" fill="#7c3aed">e1</text>

    <!-- Line direction indicator -->
    <line x1="170" y1="70" x2="170" y2="170" stroke="#7c3aed" stroke-width="2" stroke-dasharray="5,3"/>
    <polygon points="170,180 165,165 175,165" fill="#7c3aed"/>

    <!-- Ownership labels -->
    <text x="130" y="90" text-anchor="end" font-family="system-ui, sans-serif" font-size="9" fill="#1e40af">clockwise_</text>
    <text x="130" y="102" text-anchor="end" font-family="system-ui, sans-serif" font-size="9" fill="#1e40af">polygon_owner</text>

    <text x="210" y="90" font-family="system-ui, sans-serif" font-size="9" fill="#166534">counterclockwise_</text>
    <text x="210" y="102" font-family="system-ui, sans-serif" font-size="9" fill="#166534">polygon_owner</text>
  </g>

  <!-- Bottom row: Cross product and Side definitions SIDE BY SIDE -->

  <!-- Cross product formula (left) -->
  <g transform="translate(50, 320)">
    <rect x="0" y="0" width="380" height="140" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
    <text x="190" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#92400e">Cross Product Test</text>

    <text x="20" y="55" font-family="monospace" font-size="11" fill="#78350f">cross = (e1.x - e0.x) * (center.y - e1.y)</text>
    <text x="20" y="73" font-family="monospace" font-size="11" fill="#78350f">     - (e1.y - e0.y) * (center.x - e1.x)</text>

    <text x="20" y="100" font-family="system-ui, sans-serif" font-size="11" fill="#92400e">cross &gt; 0: polygon center is clockwise from line</text>
    <text x="20" y="118" font-family="system-ui, sans-serif" font-size="11" fill="#92400e">cross &lt; 0: polygon center is counterclockwise</text>

    <text x="190" y="135" text-anchor="middle" font-family="monospace" font-size="9" fill="#a16207">map_constructors.c:800</text>
  </g>

  <!-- Rule box (middle) -->
  <g transform="translate(50, 475)">
    <rect x="0" y="0" width="380" height="70" rx="6" fill="#faf5ff" stroke="#7c3aed" stroke-width="2"/>
    <text x="190" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#6b21a8">The Rule:</text>
    <text x="190" y="42" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#7c3aed">Looking from e0 to e1:</text>
    <text x="190" y="60" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#7c3aed">Clockwise owner is on the RIGHT</text>
  </g>

  <!-- Side ownership diagram (right) -->
  <g transform="translate(470, 320)">
    <rect x="0" y="0" width="380" height="140" rx="8" fill="#f0fdf4" stroke="#16a34a" stroke-width="2"/>
    <text x="190" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#166534">Side Definitions (Wall Textures)</text>

    <text x="20" y="55" font-family="system-ui, sans-serif" font-size="11" fill="#166534">Each line can have two sides (wall textures):</text>

    <text x="30" y="85" font-family="monospace" font-size="10" fill="#15803d">clockwise_polygon_side_index</text>
    <text x="290" y="85" font-family="system-ui, sans-serif" font-size="10" fill="#166534">faces A</text>

    <text x="30" y="105" font-family="monospace" font-size="10" fill="#15803d">counterclockwise_polygon_side_index</text>
    <text x="320" y="105" font-family="system-ui, sans-serif" font-size="10" fill="#166534">faces B</text>

    <text x="20" y="130" font-family="system-ui, sans-serif" font-size="10" fill="#64748b">Either can be NONE (no texture on that side)</text>
  </g>

  <!-- Source reference -->
  <text x="450" y="580" text-anchor="middle" font-family="monospace" font-size="10" fill="#94a3b8">Source: map.h:424-430, 578 â€” struct line_data, struct polygon_data</text>
</svg>

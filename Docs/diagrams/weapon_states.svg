<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 700">
  <!-- Background -->
  <rect width="950" height="700" fill="#f8fafc"/>

  <!-- Title -->
  <text x="475" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="20" font-weight="bold" fill="#1e293b">Weapon State Machine</text>
  <text x="475" y="50" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#64748b">from weapons.c — player weapon handling</text>

  <!-- Main state machine -->
  <g transform="translate(50, 80)">
    <!-- _weapon_idle -->
    <rect x="350" y="0" width="140" height="45" rx="22" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
    <text x="420" y="20" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#166534">_weapon_idle</text>
    <text x="420" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#16a34a">(ready to fire)</text>

    <!-- Arrows from idle -->
    <!-- To raising (switch weapon) -->
    <line x1="350" y1="22" x2="200" y2="22" stroke="#475569" stroke-width="2"/>
    <line x1="200" y1="22" x2="200" y2="70" stroke="#475569" stroke-width="2"/>
    <polygon points="200,75 195,65 205,65" fill="#475569"/>
    <text x="270" y="15" font-family="system-ui, sans-serif" font-size="9" fill="#475569">switch weapon</text>

    <!-- To charging (fire pressed) -->
    <line x1="420" y1="45" x2="420" y2="130" stroke="#475569" stroke-width="2"/>
    <polygon points="420,135 415,125 425,125" fill="#475569"/>
    <text x="430" y="95" font-family="system-ui, sans-serif" font-size="9" fill="#475569">fire pressed</text>

    <!-- To reload -->
    <line x1="490" y1="22" x2="640" y2="22" stroke="#475569" stroke-width="2"/>
    <line x1="640" y1="22" x2="640" y2="70" stroke="#475569" stroke-width="2"/>
    <polygon points="640,75 635,65 645,65" fill="#475569"/>
    <text x="550" y="15" font-family="system-ui, sans-serif" font-size="9" fill="#475569">empty magazine</text>

    <!-- _weapon_lowering -->
    <rect x="130" y="80" width="140" height="45" rx="22" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
    <text x="200" y="100" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#92400e">_weapon_lowering</text>
    <text x="200" y="115" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#d97706">(put away)</text>

    <!-- Arrow to raising -->
    <line x1="200" y1="125" x2="200" y2="165" stroke="#475569" stroke-width="2"/>
    <polygon points="200,170 195,160 205,160" fill="#475569"/>
    <text x="210" y="150" font-family="system-ui, sans-serif" font-size="9" fill="#475569">done</text>

    <!-- _weapon_raising -->
    <rect x="130" y="175" width="140" height="45" rx="22" fill="#dbeafe" stroke="#2563eb" stroke-width="2"/>
    <text x="200" y="195" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#1e40af">_weapon_raising</text>
    <text x="200" y="210" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#2563eb">(new weapon)</text>

    <!-- Arrow back to idle -->
    <path d="M 200,220 L 200,260 L 350,260 L 350,45" stroke="#475569" stroke-width="2" fill="none"/>
    <polygon points="350,45 345,55 355,55" fill="#475569"/>
    <text x="270" y="255" font-family="system-ui, sans-serif" font-size="9" fill="#475569">ready</text>

    <!-- _weapon_charging -->
    <rect x="350" y="140" width="140" height="45" rx="22" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
    <text x="420" y="160" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#4338ca">_weapon_charging</text>
    <text x="420" y="175" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#6366f1">(fusion pistol)</text>

    <!-- Arrow to charged -->
    <line x1="420" y1="185" x2="420" y2="220" stroke="#475569" stroke-width="2"/>
    <polygon points="420,225 415,215 425,215" fill="#475569"/>
    <text x="430" y="205" font-family="system-ui, sans-serif" font-size="9" fill="#475569">charge full</text>

    <!-- _weapon_charged -->
    <rect x="350" y="230" width="140" height="45" rx="22" fill="#f3e8ff" stroke="#9333ea" stroke-width="2"/>
    <text x="420" y="250" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#7e22ce">_weapon_charged</text>
    <text x="420" y="265" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#9333ea">(ready to release)</text>

    <!-- Arrow to firing -->
    <line x1="420" y1="275" x2="420" y2="310" stroke="#475569" stroke-width="2"/>
    <polygon points="420,315 415,305 425,305" fill="#475569"/>
    <text x="430" y="295" font-family="system-ui, sans-serif" font-size="9" fill="#475569">release</text>

    <!-- _weapon_firing -->
    <rect x="350" y="320" width="140" height="45" rx="22" fill="#fecaca" stroke="#dc2626" stroke-width="2"/>
    <text x="420" y="340" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#991b1b">_weapon_firing</text>
    <text x="420" y="355" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#dc2626">(projectile spawned)</text>

    <!-- Arrow to recovering -->
    <line x1="420" y1="365" x2="420" y2="400" stroke="#475569" stroke-width="2"/>
    <polygon points="420,405 415,395 425,395" fill="#475569"/>
    <text x="430" y="385" font-family="system-ui, sans-serif" font-size="9" fill="#475569">anim done</text>

    <!-- _weapon_recovering -->
    <rect x="350" y="410" width="140" height="45" rx="22" fill="#cffafe" stroke="#0891b2" stroke-width="2"/>
    <text x="420" y="430" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#0e7490">_weapon_recovering</text>
    <text x="420" y="445" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#0891b2">(cooldown)</text>

    <!-- Arrow back to idle -->
    <path d="M 490,432 L 540,432 L 540,22 L 490,22" stroke="#475569" stroke-width="2" fill="none"/>
    <polygon points="490,22 500,17 500,27" fill="#475569"/>
    <text x="550" y="230" font-family="system-ui, sans-serif" font-size="9" fill="#475569" transform="rotate(90, 550, 230)">cooldown done</text>

    <!-- Reload states -->
    <!-- _weapon_awaiting_reload -->
    <rect x="570" y="80" width="160" height="45" rx="22" fill="#fef9c3" stroke="#ca8a04" stroke-width="2"/>
    <text x="650" y="100" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#a16207">_awaiting_reload</text>
    <text x="650" y="115" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#ca8a04">(magazine empty)</text>

    <!-- Arrow to waiting_to_load -->
    <line x1="650" y1="125" x2="650" y2="165" stroke="#475569" stroke-width="2"/>
    <polygon points="650,170 645,160 655,160" fill="#475569"/>
    <text x="660" y="150" font-family="system-ui, sans-serif" font-size="9" fill="#475569">has ammo</text>

    <!-- _weapon_waiting_to_load -->
    <rect x="570" y="175" width="160" height="45" rx="22" fill="#fef9c3" stroke="#ca8a04" stroke-width="2"/>
    <text x="650" y="195" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#a16207">_waiting_to_load</text>
    <text x="650" y="210" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#ca8a04">(loading animation)</text>

    <!-- Arrow to finishing_reload -->
    <line x1="650" y1="220" x2="650" y2="260" stroke="#475569" stroke-width="2"/>
    <polygon points="650,265 645,255 655,255" fill="#475569"/>
    <text x="660" y="245" font-family="system-ui, sans-serif" font-size="9" fill="#475569">loaded</text>

    <!-- _weapon_finishing_reload -->
    <rect x="570" y="270" width="160" height="45" rx="22" fill="#fef9c3" stroke="#ca8a04" stroke-width="2"/>
    <text x="650" y="290" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#a16207">_finishing_reload</text>
    <text x="650" y="305" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#ca8a04">(ready again)</text>

    <!-- Arrow back to idle -->
    <path d="M 650,315 L 650,350 L 540,350 L 540,22 L 490,22" stroke="#16a34a" stroke-width="2" fill="none"/>
    <text x="590" y="345" font-family="system-ui, sans-serif" font-size="9" fill="#16a34a">done</text>
  </g>

  <!-- Weapon types -->
  <g transform="translate(50, 530)">
    <rect x="0" y="0" width="420" height="130" rx="8" fill="#f0fdf4" stroke="#16a34a" stroke-width="2"/>
    <text x="210" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#166534">Weapon Types</text>

    <text x="15" y="45" font-family="monospace" font-size="9" fill="#166534">_weapon_fist          // 0 - Melee</text>
    <text x="15" y="60" font-family="monospace" font-size="9" fill="#166534">_weapon_pistol        // 1 - Can dual-wield</text>
    <text x="15" y="75" font-family="monospace" font-size="9" fill="#166534">_weapon_plasma_pistol // 2 - Chargeable</text>
    <text x="15" y="90" font-family="monospace" font-size="9" fill="#166534">_weapon_assault_rifle // 3 - +grenade launcher</text>
    <text x="15" y="105" font-family="monospace" font-size="9" fill="#166534">_weapon_shotgun       // 7 - Can dual-wield</text>

    <text x="230" y="45" font-family="monospace" font-size="9" fill="#166534">_weapon_missile_launcher // 4</text>
    <text x="230" y="60" font-family="monospace" font-size="9" fill="#166534">_weapon_flamethrower     // 5</text>
    <text x="230" y="75" font-family="monospace" font-size="9" fill="#166534">_weapon_alien_shotgun    // 6</text>
    <text x="230" y="90" font-family="monospace" font-size="9" fill="#166534">_weapon_ball             // 8</text>
    <text x="230" y="105" font-family="monospace" font-size="9" fill="#166534">_weapon_smg              // 9</text>

    <text x="210" y="123" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#64748b">MAXIMUM_NUMBER_OF_WEAPONS = 10</text>
  </g>

  <!-- Dual wield states -->
  <g transform="translate(490, 530)">
    <rect x="0" y="0" width="410" height="130" rx="8" fill="#fef2f2" stroke="#dc2626" stroke-width="2"/>
    <text x="205" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#991b1b">Dual-Wield Special States</text>

    <text x="15" y="48" font-family="system-ui, sans-serif" font-size="10" fill="#991b1b">Extra states for akimbo weapons (pistols, shotguns):</text>

    <text x="20" y="68" font-family="monospace" font-size="9" fill="#dc2626">_lowering_for_twofisted_reload</text>
    <text x="20" y="83" font-family="monospace" font-size="9" fill="#dc2626">_awaiting_twofisted_reload</text>
    <text x="20" y="98" font-family="monospace" font-size="9" fill="#dc2626">_waiting_for_twofist_to_reload</text>
    <text x="20" y="113" font-family="monospace" font-size="9" fill="#dc2626">_sliding_over_to_second_position</text>

    <text x="15" y="128" font-family="system-ui, sans-serif" font-size="9" fill="#64748b">One hand lowers while other reloads</text>
  </g>

  <!-- Source reference -->
  <text x="475" y="690" text-anchor="middle" font-family="monospace" font-size="10" fill="#94a3b8">Source: weapons.c, weapon_definitions.h — update_player_weapons()</text>
</svg>

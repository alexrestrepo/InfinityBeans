<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 650">
  <!-- Background -->
  <rect width="950" height="650" fill="#f8fafc"/>

  <!-- Title -->
  <text x="475" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="20" font-weight="bold" fill="#1e293b">Shape Collection Memory Layout</text>
  <text x="475" y="50" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#64748b">from shapes.c, shape_definitions.h — sprites and textures</text>

  <!-- File structure (left) -->
  <g transform="translate(50, 80)">
    <text x="150" y="0" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#475569">Shapes File (Data Fork)</text>

    <!-- Collection headers -->
    <rect x="0" y="20" width="300" height="60" rx="6" fill="#dbeafe" stroke="#2563eb" stroke-width="2"/>
    <text x="150" y="42" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#1e40af">Collection Headers</text>
    <text x="150" y="58" text-anchor="middle" font-family="monospace" font-size="9" fill="#3b82f6">collection_header[MAXIMUM_COLLECTIONS]</text>
    <text x="150" y="72" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#64748b">32 collections max</text>

    <!-- Arrow -->
    <line x1="150" y1="80" x2="150" y2="95" stroke="#475569" stroke-width="2"/>
    <polygon points="150,100 145,90 155,90" fill="#475569"/>

    <!-- Collection data blocks -->
    <rect x="0" y="105" width="300" height="70" rx="6" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
    <text x="150" y="128" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#166534">Collection 0 Data</text>
    <text x="150" y="145" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#16a34a">Walls and scenery textures</text>
    <text x="150" y="162" text-anchor="middle" font-family="monospace" font-size="8" fill="#64748b">offset: header[0].offset, size: header[0].length</text>

    <rect x="0" y="185" width="300" height="70" rx="6" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
    <text x="150" y="208" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#92400e">Collection 1 Data</text>
    <text x="150" y="225" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#d97706">Water/liquid textures</text>
    <text x="150" y="242" text-anchor="middle" font-family="monospace" font-size="8" fill="#64748b">offset: header[1].offset, size: header[1].length</text>

    <text x="150" y="275" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" fill="#64748b">⋮</text>

    <rect x="0" y="290" width="300" height="70" rx="6" fill="#f3e8ff" stroke="#9333ea" stroke-width="2"/>
    <text x="150" y="313" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#7e22ce">Collection N Data</text>
    <text x="150" y="330" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#9333ea">Monster/weapon sprites</text>
    <text x="150" y="347" text-anchor="middle" font-family="monospace" font-size="8" fill="#64748b">offset: header[N].offset, size: header[N].length</text>
  </g>

  <!-- Collection definition structure (right) -->
  <g transform="translate(400, 80)">
    <text x="260" y="0" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#475569">Collection Definition (in memory)</text>

    <rect x="0" y="20" width="520" height="340" rx="8" fill="#f8fafc" stroke="#94a3b8" stroke-width="2"/>

    <!-- Definition header -->
    <rect x="15" y="35" width="490" height="55" rx="4" fill="#dbeafe" stroke="#2563eb" stroke-width="1"/>
    <text x="260" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#1e40af">collection_definition header</text>
    <text x="30" y="75" font-family="monospace" font-size="9" fill="#3b82f6">version, type, flags, color_count, colors_per_table</text>
    <text x="30" y="85" font-family="monospace" font-size="9" fill="#3b82f6">high_level_shape_count, low_level_shape_count, bitmap_count</text>

    <!-- Color tables -->
    <rect x="15" y="100" width="490" height="50" rx="4" fill="#dcfce7" stroke="#16a34a" stroke-width="1"/>
    <text x="260" y="120" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#166534">Color Tables (palettes)</text>
    <text x="30" y="140" font-family="monospace" font-size="9" fill="#16a34a">rgb_color_value[color_count * colors_per_table]</text>

    <!-- High level shapes -->
    <rect x="15" y="160" width="490" height="55" rx="4" fill="#fef3c7" stroke="#d97706" stroke-width="1"/>
    <text x="260" y="180" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#92400e">High-Level Shapes (animations)</text>
    <text x="30" y="198" font-family="monospace" font-size="9" fill="#d97706">high_level_shape_definition[high_level_shape_count]</text>
    <text x="30" y="210" font-family="system-ui, sans-serif" font-size="8" fill="#64748b">Groups of frames: idle, walking, attacking, dying...</text>

    <!-- Low level shapes -->
    <rect x="15" y="225" width="490" height="55" rx="4" fill="#f3e8ff" stroke="#9333ea" stroke-width="1"/>
    <text x="260" y="245" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#7e22ce">Low-Level Shapes (frames)</text>
    <text x="30" y="263" font-family="monospace" font-size="9" fill="#9333ea">low_level_shape_definition[low_level_shape_count]</text>
    <text x="30" y="275" font-family="system-ui, sans-serif" font-size="8" fill="#64748b">Individual sprite frames with offsets</text>

    <!-- Bitmaps -->
    <rect x="15" y="290" width="490" height="55" rx="4" fill="#fecaca" stroke="#dc2626" stroke-width="1"/>
    <text x="260" y="310" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#991b1b">Bitmap Data (pixels)</text>
    <text x="30" y="328" font-family="monospace" font-size="9" fill="#dc2626">bitmap_definition[bitmap_count] + raw pixel data</text>
    <text x="30" y="340" font-family="system-ui, sans-serif" font-size="8" fill="#64748b">8-bit indexed color, column-major order</text>
  </g>

  <!-- Collection IDs -->
  <g transform="translate(50, 400)">
    <rect x="0" y="0" width="300" height="180" rx="8" fill="#f0fdf4" stroke="#16a34a" stroke-width="2"/>
    <text x="150" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#166534">Collection IDs</text>

    <text x="15" y="45" font-family="monospace" font-size="9" fill="#166534">_collection_walls           // 0</text>
    <text x="15" y="60" font-family="monospace" font-size="9" fill="#166534">_collection_scenery         // 1</text>
    <text x="15" y="75" font-family="monospace" font-size="9" fill="#166534">_collection_landscape       // 2-5</text>
    <text x="15" y="90" font-family="monospace" font-size="9" fill="#166534">_collection_weapons_in_hand // 6</text>
    <text x="15" y="105" font-family="monospace" font-size="9" fill="#166534">_collection_interface       // 7</text>
    <text x="15" y="120" font-family="monospace" font-size="9" fill="#166534">_collection_player          // 8</text>
    <text x="15" y="135" font-family="monospace" font-size="9" fill="#166534">_collection_items           // 9</text>
    <text x="15" y="150" font-family="monospace" font-size="9" fill="#166534">_collection_monsters        // 10-31</text>

    <text x="150" y="172" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#64748b">MAXIMUM_COLLECTIONS = 32</text>
  </g>

  <!-- Shape descriptor -->
  <g transform="translate(380, 440)">
    <rect x="0" y="0" width="520" height="140" rx="8" fill="#fef2f2" stroke="#dc2626" stroke-width="2"/>
    <text x="260" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#991b1b">Shape Descriptor (16-bit packed)</text>

    <!-- Bit layout -->
    <g transform="translate(20, 40)">
      <rect x="0" y="0" width="120" height="35" fill="#fecaca" stroke="#dc2626" stroke-width="1"/>
      <text x="60" y="15" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="bold" fill="#991b1b">Collection</text>
      <text x="60" y="28" text-anchor="middle" font-family="monospace" font-size="8" fill="#991b1b">bits 15-11 (5 bits)</text>

      <rect x="120" y="0" width="100" height="35" fill="#fef3c7" stroke="#d97706" stroke-width="1"/>
      <text x="170" y="15" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="bold" fill="#92400e">CLUT</text>
      <text x="170" y="28" text-anchor="middle" font-family="monospace" font-size="8" fill="#92400e">bits 10-8 (3 bits)</text>

      <rect x="220" y="0" width="240" height="35" fill="#dcfce7" stroke="#16a34a" stroke-width="1"/>
      <text x="340" y="15" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="bold" fill="#166534">Low-Level Shape Index</text>
      <text x="340" y="28" text-anchor="middle" font-family="monospace" font-size="8" fill="#166534">bits 7-0 (8 bits)</text>
    </g>

    <text x="20" y="95" font-family="monospace" font-size="9" fill="#475569">BUILD_DESCRIPTOR(collection, clut, shape)</text>
    <text x="20" y="110" font-family="monospace" font-size="9" fill="#475569">GET_COLLECTION(descriptor) = (descriptor &gt;&gt; 11) &amp; 0x1F</text>
    <text x="20" y="125" font-family="monospace" font-size="9" fill="#475569">GET_SHAPE_INDEX(descriptor) = descriptor &amp; 0xFF</text>
  </g>

  <!-- Source reference -->
  <text x="475" y="640" text-anchor="middle" font-family="monospace" font-size="10" fill="#94a3b8">Source: shapes.c, shape_definitions.h — load_collection(), struct collection_definition</text>
</svg>
